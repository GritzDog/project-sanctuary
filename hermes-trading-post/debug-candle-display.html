<!DOCTYPE html>
<html>
<head>
    <title>Debug Candle Display</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #chart { width: 100%; height: 400px; border: 1px solid #ccc; }
        #info { margin-top: 20px; }
        .button-group { margin: 10px 0; }
        button { margin-right: 10px; padding: 5px 15px; }
        .active { background-color: #007bff; color: white; }
    </style>
</head>
<body>
    <h1>Debug Candle Display</h1>
    
    <div class="button-group">
        <button onclick="testNormal()">Test Normal (zoom enabled)</button>
        <button onclick="testNoZoom()">Test No Zoom (like current)</button>
        <button onclick="testFitContent()">Test Fit Content</button>
    </div>
    
    <div id="chart"></div>
    <div id="info"></div>
    
    <script>
        let chart = null;
        let candleSeries = null;
        
        // Generate test data - 60 1-minute candles
        function generateTestData() {
            const data = [];
            const now = Math.floor(Date.now() / 1000);
            const basePrice = 50000;
            
            for (let i = 59; i >= 0; i--) {
                const time = now - (i * 60);
                const variation = (Math.random() - 0.5) * 100;
                const open = basePrice + variation;
                const close = open + (Math.random() - 0.5) * 50;
                const high = Math.max(open, close) + Math.random() * 20;
                const low = Math.min(open, close) - Math.random() * 20;
                
                data.push({
                    time: time,
                    open: open,
                    high: high,
                    low: low,
                    close: close
                });
            }
            
            return data;
        }
        
        function updateInfo() {
            const range = chart.timeScale().getVisibleRange();
            if (range) {
                const rangeMinutes = (range.to - range.from) / 60;
                const info = document.getElementById('info');
                info.innerHTML = `
                    <h3>Visible Range Info:</h3>
                    <p>From: ${new Date(range.from * 1000).toLocaleString()}</p>
                    <p>To: ${new Date(range.to * 1000).toLocaleString()}</p>
                    <p>Range: ${rangeMinutes.toFixed(1)} minutes</p>
                    <p>Expected candles visible: ${Math.ceil(rangeMinutes)}</p>
                `;
            }
        }
        
        function createChart(options) {
            // Remove existing chart
            if (chart) {
                chart.remove();
            }
            
            const container = document.getElementById('chart');
            chart = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 400,
                timeScale: {
                    rightOffset: options.rightOffset || 5,
                    barSpacing: options.barSpacing || 3,
                    minBarSpacing: options.minBarSpacing || 1,
                    fixLeftEdge: options.fixLeftEdge !== undefined ? options.fixLeftEdge : false,
                    fixRightEdge: options.fixRightEdge !== undefined ? options.fixRightEdge : false,
                    timeVisible: true,
                    borderColor: '#2a2a2a',
                },
                handleScroll: {
                    mouseWheel: options.mouseWheel !== undefined ? options.mouseWheel : true,
                    pressedMouseMove: options.pressedMouseMove !== undefined ? options.pressedMouseMove : true,
                },
                handleScale: {
                    mouseWheel: options.scaleMouseWheel !== undefined ? options.scaleMouseWheel : true,
                    pinch: options.pinch !== undefined ? options.pinch : true,
                },
            });
            
            candleSeries = chart.addCandlestickSeries({
                upColor: '#26a69a',
                downColor: '#ef5350',
                borderUpColor: '#26a69a',
                borderDownColor: '#ef5350',
                wickUpColor: '#26a69a',
                wickDownColor: '#ef5350',
            });
            
            // Set data
            const data = generateTestData();
            candleSeries.setData(data);
            
            // Set visible range if requested
            if (options.setVisibleRange) {
                const now = Math.floor(Date.now() / 1000);
                const oneHourAgo = now - 3600;
                
                if (options.fitFirst) {
                    chart.timeScale().fitContent();
                }
                
                chart.timeScale().setVisibleRange({
                    from: oneHourAgo,
                    to: now
                });
            }
            
            // Subscribe to range changes
            chart.timeScale().subscribeVisibleTimeRangeChange(updateInfo);
            
            // Initial update
            setTimeout(updateInfo, 100);
        }
        
        function testNormal() {
            console.log('Testing normal chart (zoom enabled)');
            createChart({
                setVisibleRange: true,
                fitFirst: false
            });
        }
        
        function testNoZoom() {
            console.log('Testing no zoom (like current implementation)');
            createChart({
                fixLeftEdge: true,
                fixRightEdge: true,
                mouseWheel: false,
                pressedMouseMove: false,
                scaleMouseWheel: false,
                pinch: false,
                setVisibleRange: true,
                fitFirst: true,
                barSpacing: 3,
                minBarSpacing: 1
            });
        }
        
        function testFitContent() {
            console.log('Testing fit content only');
            createChart({
                fixLeftEdge: true,
                fixRightEdge: true,
                mouseWheel: false,
                pressedMouseMove: false,
                scaleMouseWheel: false,
                pinch: false,
                barSpacing: 3,
                minBarSpacing: 1
            });
            
            // Just fit content, don't set range
            setTimeout(() => {
                chart.timeScale().fitContent();
                updateInfo();
            }, 100);
        }
        
        // Start with normal test
        testNormal();
    </script>
</body>
</html>